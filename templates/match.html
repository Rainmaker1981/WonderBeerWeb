{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Beer Matches {% if brewery %}for {{ brewery.name }} ({{ brewery.city }}, {{ brewery.state }}){% endif %}</h2>
  {% if not menu %}
    <p class="kicker">No menu found for this brewery. Try another or add to <code>data/sample_menu.csv</code>.</p>
  {% endif %}
</div>

<div class="card">
  <form method="get">
    {% if brewery %}<input type="hidden" name="brewery_id" value="{{ brewery.brewery_id }}">{% endif %}
    <div class="grid cols-3">
      <div><input type="text" name="q" value="{{ request.args.get('q', '') }}" data-suggest="beer" placeholder="Search beer name"></div>
      <div><input type="text" name="style" value="{{ request.args.get('style','') }}" placeholder="Filter by style"></div>
      <div>
        <select name="order">
          <option value="score" {% if request.args.get('order','score')=='score' %}selected{% endif %}>Order by Match Score</option>
          <option value="abv" {% if request.args.get('order')=='abv' %}selected{% endif %}>Order by ABV</option>
          <option value="ibu" {% if request.args.get('order')=='ibu' %}selected{% endif %}>Order by IBU</option>
        </select>
      </div>
      <div><button class="btn primary">Apply</button></div>
    </div>
  </form>
</div>

<div class="card">
  <table>
    <thead>
      <tr><th>Beer</th><th>Style</th><th>ABV</th><th>IBU</th><th>Global â˜…</th><th>Your Pref</th><th>Score</th></tr>
    </thead>
    <tbody>
      {% for row in rows %}
        {% set name = row.get('name') %}
        {% set style = row.get('style') %}
        {% set abv = row.get('abv') %}
        {% set ibu = row.get('ibu') %}
        {% set gr = row.get('global_rating') %}
        {% set up = row.get('user_pref') %}
        {% set sc = row.get('score') %}

        <tr>
          <td>{{ name }}</td>
          <td>{{ style }}</td>

          {# ABV: show one decimal + % if present and not NaN #}
          <td>{% if abv is not none and abv==abv %}{{ abv | float | round(1) }}%{% endif %}</td>

          {# IBU: integer if present and not NaN #}
          <td>{% if ibu is not none and ibu==ibu %}{{ ibu | float | round(0) | int }}{% endif %}</td>

          {# Global rating & user pref: two decimals if present and not NaN #}
          <td>{% if gr is not none and gr==gr %}{{ gr | float | round(2) }}{% endif %}</td>
          <td>{% if up is not none and up==up %}{{ up | float | round(2) }}{% endif %}</td>

          {# Score: two decimals if present #}
          <td class="score">{% if sc is not none and sc==sc %}{{ sc | float | round(2) }}{% endif %}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
